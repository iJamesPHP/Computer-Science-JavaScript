<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>James' Computer Science Hub</title>
    <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/homepage.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
  </head>

  <body>
    <div class="container">
      <div class="page-header">
          <h1>JavaScript Traffic Lights <small><span class="glyphicon glyphicon-question-sign"></span> Question 3</span></small></h1>
      </div>
      <h2 class="text-center"><b>Traffic Lights</b></h2>
      <div class="row text-center">
        <img src="../../images/JavaScript/3/red-circle.png" id="red-light" height="7%" width="7%" />
      </div>
      <div class="row text-center" style="margin-top: 10px">
        <img src="../../images/JavaScript/3/grey-circle.png" id="amber-light" height="7%" width="7%" />
      </div>
      <div class="row text-center" style="margin-top: 10px">
        <img src="../../images/JavaScript/3/grey-circle.png" id="green-light" height="7%" width="7%" />
      </div>
      <div class="row text-center" style="margin-top: 20px">
        <button type="button" class="btn btn-primary btn-lg" onclick="runSequence()" id="playSequence">
          <span class="glyphicon glyphicon-play"></span>&nbsp; Play Light Sequence
        </button>
        <br>
        <button type="button" class="btn btn-warning btn-lg" onclick="runAutomatically()" style="margin-top: 20px" id="runAutomatically">
          <span class="glyphicon glyphicon-transfer"></span>&nbsp; Run Automatically
        </button>
        <button type="button" class="btn btn-danger btn-lg" onclick="stopRunningAutomatically()" style="margin-top: 20px; display: none" id="stopRunning">
          <span class="glyphicon glyphicon-stop"></span>&nbsp; Stop Running Automatically
        </button>
      </div>
    </div>

    <footer class="footer">
      <div class="container text-center">
        <p class="text-muted" style="margin-top: 20px">Site written & designed by James Latham for UTC@MediaCityUK Computer Science Work</p>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../bootstrap/js/bootstrap.min.js"></script>

    <script type="text/javascript">
      $('#stopRunning').hide();
      redLight = document.getElementById('red-light');
      amberLight = document.getElementById('amber-light');
      greenLight = document.getElementById('green-light');
      src_prefix = "../../images/JavaScript/3/";
      autoRun = false;

      // Define traffic light sequence
      var lightSequence = [
        {red: true, amber: false, green: false},
        {red: true, amber: true, green: false},
        {red: false, amber: false, green: true},
        {red: false, amber: true, green: false}
      ];
      var sequenceIndex = 0;

      function setLight(light,state) {
        if (!state) {
            // switch light OFF
            light.src = src_prefix + 'grey-circle.png';
            return;
        }
        // switch light on
        switch (light.id) {
          case 'red-light' :
            light.src = src_prefix + 'red-circle.png';
            break;
          case 'amber-light' :
            light.src = src_prefix + 'amber-circle.png';
            break;
          case 'green-light' :
            light.src = src_prefix + 'green-circle.png';
            break;
          default:
            alert ('Invalid Light');
            break;
        }
      }

      function setLightSequence(index) {
        // Check array in bounds
        if (index < lightSequence.length) {
          setLight(redLight,lightSequence[index].red);
          setLight(amberLight,lightSequence[index].amber);
          setLight(greenLight,lightSequence[index].green);
        }
      }



/*
      function switchLight (light)
      {
        switch (light.id)
        {
          case 'light-1':
            if (light.src.includes('grey-circle.png')) {
              light.src = src_prefix + 'red-circle.png';
            } else {
              light.src = src_prefix + 'grey-circle.png';
            }
            break;
          case 'light-2':
            if (light.src.includes('grey-circle.png')) {
              light.src = src_prefix + 'amber-circle.png';
            } else {
              light.src = src_prefix + 'grey-circle.png';
            }
            break;
          case 'light-3':
            if (light.src.includes('grey-circle.png')) {
              light.src = src_prefix + 'green-circle.png';
            } else {
              light.src = src_prefix + 'grey-circle.png';
            }
            break;
          default:
            alert ('Invalid Light');
        }
      }
      */

      function lightsLoop(timeout) {
        setTimeout(function () {
            setLightSequence(sequenceIndex);
            if (++sequenceIndex <= lightSequence.length) {
               lightsLoop(3000);  // loop again
            }
            else {
              // End sequence
              sequenceIndex = 0;
              setLightSequence(sequenceIndex);

              // If set to auto then run sequence again
              if (autoRun) {
                sequenceIndex++;
                lightsLoop(3000);  // loop again
              }
            }
         }, timeout)
      }

      function runSequence ()
      {
        $('#playSequence').prop('disabled', true);
        $('#runAutomatically').prop('disabled', true);
        oldButtonText = $('#playSequence').html();
        $('#playSequence').html('Playing...');

        // Loop over sequence
        lightsLoop(0);

        $('#playSequence').prop('disabled', false);
        $('#runAutomatically').prop('disabled', false);
        $('#playSequence').html(oldButtonText);

      }

/*
setTimeout(function() {
  switchLight(light2);
}, 500);
setTimeout(function() {
  switchLight(light1);
  switchLight(light2);
  switchLight(light3);
}, 2000);
setTimeout(function() {
  switchLight(light1);
  switchLight(light3);
  $('#playSequence').prop('disabled', false);
  $('#runAutomatically').prop('disabled', false);
  $('#playSequence').html(oldButtonText);
}, 2600);

*/
      function stopRunningAutomatically ()
      {
        autoRun = false;
        oldStopRunningtext = $('#stopRunning').html();
        $('#stopRunning').html('<span class="glyphicon glyphicon-time"></span>&nbsp; Waiting for sequence to end...');

        $('#runAutomatically').show();
        $('#stopRunning').hide();
        $('#stopRunning').html(oldStopRunningtext);


      }

      function runAutomatically ()
      {
        autoRun = true;
        $('#runAutomatically').hide();
        $('#stopRunning').show();
        runSequence();


      }
    </script>

  </body>

</html>
